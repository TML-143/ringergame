<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#050814" />
    <title>Ringer Game</title>

    <link rel="icon" href="ringer_game_icon.png" />
    <link rel="manifest" href="manifest.webmanifest" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7TEG531231"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
    </script>

    <link rel="stylesheet" href="./app.css">
  </head>
  <body>
    <div id="app">
      <div id="screenHome" class="rg-screen rg-active" aria-hidden="false">
        <section class="pane rg-splash">
          <div class="rg-screen-body">
            <div class="rg-home" aria-label="Home">
              <div class="rg-home-brand" aria-label="Title">
                <div class="rg-home-title">Ringer Game</div>
                <img id="homeBellLogo" class="rg-home-logo" src="bell.png" alt="Bell logo" role="button" tabindex="0" />
              </div>
              <div class="rg-home-menu" aria-label="Home navigation">
                <button id="homeBtnPlay" class="pill" type="button">Setup</button>
                <button id="homeBtnView" class="pill" type="button">View</button>
                <button id="homeBtnSound" class="pill" type="button">Sound</button>
              </div>
              <div class="rg-home-bottom" aria-label="Quick start">
                <button id="homeBtnDemo" class="pill" type="button">Demo</button>
                <button id="homeBtnBegin" class="pill" type="button">Play</button>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div id="screenPlay" class="rg-screen" aria-hidden="true">
        <section class="pane rg-splash">
          <div class="pane-title"><span>Setup</span></div>
          <div class="rg-screen-body">
            <div id="playMenuControls" class="rg-controls" aria-label="Setup controls"></div>
            <div id="setupCCCBRLibraryControl" class="control">
              <label>CCCBR Library</label>
              <a id="setupCCCBRDownloadLink" href="https://methods.cccbr.org.uk/xml/CCCBR_methods.xml.zip" target="_blank" rel="noopener">CCCBR methods library (download ZIP)</a>
              <button id="setupLoadCCCBRWebBtn" class="pill" type="button">Download &amp; Load CCCBR library</button>
              <span id="setupLoadCCCBRWebStatus" class="rg-muted"></span>
            </div>
            <div class="control">
              <button id="setupExploreLibraryBtn" class="pill" type="button" disabled title="Load a CCCBR library XML/ZIP first">Explore library</button>
            </div>
            <div class="stats-info">
              Scoring: each scored bell gets one chance per row. Ring in its window: middle third = 10, outer thirds = 9. Outside window = 0. Only the first ring per bell per row counts.
            </div>
            <div class="rg-nav">
              <button class="pill" type="button" data-go-screen="play">Setup</button>
              <button class="pill" type="button" data-go-screen="view">View</button>
              <button class="pill" type="button" data-go-screen="sound">Sound</button>
              <button id="playBtnEnterGame" class="pill" type="button">Play</button>
              <button id="playBtnDemo" class="pill" type="button">Demo</button>
            </div>
          </div>
        </section>
      </div>

      <div id="screenView" class="rg-screen" aria-hidden="true">
        <section class="pane rg-splash">
          <div class="pane-title"><span>View</span></div>
          <div class="rg-screen-body">
            <div id="viewMenuControls" class="rg-controls" aria-label="View controls">
              <div class="control">
                <label for="layoutPresetSelect">Layout preset</label>
                <select id="layoutPresetSelect">
                  <option value="auto">Auto (recommended)</option>
                  <option value="two_col">Two columns (classic)</option>
                  <option value="one_wide">One column (wide)</option>
                  <option value="one_narrow">One column (narrow / centered)</option>
                  <option value="mobile_thumb">Mobile (thumb reach)</option>
                </select>
                <div class="control-note rg-muted">Controls layout only; window toggles still control what is shown.</div>
              </div>
            </div>
            <div class="rg-nav">
              <button class="pill" type="button" data-go-screen="play">Setup</button>
              <button class="pill" type="button" data-go-screen="view">View</button>
              <button class="pill" type="button" data-go-screen="sound">Sound</button>
              <button id="viewBtnEnterGame" class="pill" type="button">Play</button>
              <button id="viewBtnDemo" class="pill" type="button">Demo</button>
            </div>
          </div>
        </section>
      </div>

      <div id="screenSound" class="rg-screen" aria-hidden="true">
        <section class="pane rg-splash">
          <div class="pane-title"><span>Sound</span></div>
          <div class="rg-screen-body">
            <div id="soundMenuControls" class="rg-controls" aria-label="Sound controls"></div>
            <div class="rg-nav">
              <button class="pill" type="button" data-go-screen="play">Setup</button>
              <button class="pill" type="button" data-go-screen="view">View</button>
              <button class="pill" type="button" data-go-screen="sound">Sound</button>
              <button id="soundBtnEnterGame" class="pill" type="button">Play</button>
              <button id="soundBtnDemo" class="pill" type="button">Demo</button>
            </div>
          </div>
        </section>
      </div>

      <div id="screenLibrary" class="rg-screen" aria-hidden="true">
        <section class="pane rg-splash">
          <div class="pane-title"><span>Method Library</span></div>
          <div class="rg-screen-body">
            <div class="rg-muted rg-library-loaded">Loaded library: <span id="libraryFileName">none</span></div>
            <div id="libraryNotationPlaceholder" aria-label="Library notation placeholder">
              <div id="libraryNotLoadedNotice" class="rg-library-notice hidden">
                <div class="rg-muted rg-library-notice-title">No CCCBR library loaded yet.</div>
                <div class="rg-library-notice-actions">
                  <button id="libraryGoSetupBtn" class="pill" type="button">Go to Setup</button>
                </div>
                <div class="rg-library-notice-links">
                  <a href="https://methods.cccbr.org.uk/xml/CCCBR_methods.xml.zip" target="_blank" rel="noopener">CCCBR methods library (download ZIP)</a>
                </div>
              </div>

              <div id="libraryLayout" class="rg-library-layout">
                <div class="rg-library-col rg-library-browse" aria-label="Browse">
                  <div class="rg-library-col-head">
                    <div class="rg-library-col-title">Browse</div>
                    <input id="librarySearchInput" type="search" placeholder="Search open groups…" autocomplete="off" />
                  </div>
                  <div id="libraryBrowseGroups" class="rg-library-groups"></div>
                </div>

                <div class="rg-library-col rg-library-details" aria-label="Details">
                  <div id="libraryDetailsEmpty" class="rg-muted">Select a method to see details.</div>
                  <div id="libraryDetailsPanel" class="hidden">
                    <div id="librarySelectedTitle" class="rg-library-selected-title"></div>
                    <div id="librarySelectedMeta" class="rg-library-selected-meta"></div>
                    <div id="libraryGlossary" class="rg-library-section"></div>
                    <div id="libraryNotes" class="rg-library-section"></div>

                    <div class="rg-library-actions">
                      <button id="libraryPlaySelectedBtn" class="pill" type="button" disabled>Play</button>
                      <button id="libraryDemoSelectedBtn" class="pill" type="button" disabled>Demo</button>
                    </div>

                    <div class="rg-library-preview">
                      <div class="rg-library-preview-head">
                        <div class="rg-library-col-title">Preview</div>
                        <div class="rg-library-line">
                          <label for="libraryLineBellSelect" class="rg-muted">Line bell</label>
                          <select id="libraryLineBellSelect"></select>
                        </div>
                      </div>
                      <pre id="libraryPreview" class="rg-library-preview-pre"></pre>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="rg-nav">
              <button class="pill" type="button" data-go-screen="play">Setup</button>
              <button class="pill" type="button" data-go-screen="view">View</button>
              <button class="pill" type="button" data-go-screen="sound">Sound</button>
              <button id="libraryBtnEnterGame" class="pill" type="button">Play</button>
              <button id="libraryBtnDemo" class="pill" type="button">Demo</button>
            </div>
          </div>
        </section>
      </div>

      <div id="screenGame" class="rg-screen" aria-hidden="true">

      <div id="countOverlay" class="count-overlay" aria-hidden="true"></div>
      <header class="top-bar">
        <div class="rg-game-head">
          <h1>Ringer Game</h1>
          <div class="rg-game-meta" aria-label="Method and tempo">
            <div class="rg-game-meta-line">
              <span id="gameMetaMethod"></span>
              <span id="gameMetaSource" class="rg-muted"></span>
            </div>
            <div class="rg-game-meta-line">
              <span id="gameMetaAttr" class="rg-muted hidden"></span>
              <span id="gameMetaBpm" class="rg-muted"></span>
            </div>
          </div>
        </div>
        <button id="menuToggle" class="menu-toggle" type="button" aria-label="Menu" title="Menu">▾</button>

        <div id="controls">
          <div class="control">
            <label for="methodSelect">Method</label>
            <select id="methodSelect">
              <option value="plainhunt">Plain Hunt</option>
              <option value="plainbob">Plain Bob (variation)</option>
              <option value="grandsire">Grandsire (variation)</option>
              <option value="custom">Custom (text file)</option>
            </select>
          </div>

          <div class="control">
            <label for="bellCount" title="Stage = number of bells (4–12).">Bells (stage)</label>
            <select id="bellCount">
              <option value="4">4 (Minimus)</option>
              <option value="5">5 (Doubles)</option>
              <option value="6" selected>6 (Minor)</option>
              <option value="7">7 (Triples)</option>
              <option value="8">8 (Major)</option>
              <option value="9">9 (Caters)</option>
              <option value="10">10 (Royal)</option>
              <option value="11">11 (Cinques)</option>
              <option value="12">12 (Maximus)</option>
            </select>
          </div>

          <div class="control">
            <label for="scaleSelect" title="Musical key used to tune bells (or choose Custom (Hz)).">Bell key</label>
            <select id="scaleSelect"></select>
          </div>

          <div class="control">
            <label for="octaveSelect" title="C-octave register used for tuning (C1–C6).">Register (C octave)</label>
            <select id="octaveSelect"></select>
          </div>

          <div class="control">
            <label for="bellCustomHzInput">Bell root (Hz)</label>
            <input id="bellCustomHzInput" type="number" min="20" max="4000" step="0.01" value="440" />
            <input id="bellCustomHzSlider" type="range" min="20" max="4000" step="1" value="440" aria-label="Bell root Hz slider" />
          </div>

          <div class="control">
            <label for="bellVolume">Bell volume</label>
            <input id="bellVolume" type="range" min="0" max="100" value="100" />
          </div>

          <div class="control">
            <label for="droneTypeSelect">Drone type</label>
            <select id="droneTypeSelect">
              <option value="off" selected>Off</option>
              <option value="single">Single tone</option>
              <option value="octaves">Octaves (low–mid–high)</option>
              <option value="root5">Root + 5th</option>
              <option value="fifth">Root + 5th + octave</option>
              <option value="majtriad">Major triad (1–3–5)</option>
              <option value="mintriad">Minor triad (1–♭3–5)</option>
              <option value="seventh">Major 7 (1–3–5–7)</option>
              <option value="harm4">Harmonic stack (1–4)</option>
              <option value="harm6">Harmonic stack (1–6)</option>
              <option value="oddharm">Odd harmonics (1,3,5,7)</option>
              <option value="shepard">Octave cloud (Shepard-like)</option>
              <option value="cluster">Semitone cluster (±3)</option>
              <option value="noise">Noise drone (tone-aware)</option>
              <option value="resnoise">Resonant noise</option>
              <option value="noisetone">Noise + gentle tone</option>
            </select>
          </div>

          <div class="control">
            <label for="droneScaleSelect" title="Musical key used to tune the drone (or choose Custom (Hz)).">Drone key</label>
            <select id="droneScaleSelect"></select>
          </div>

          <div class="control">
            <label for="droneOctaveSelect" title="C-octave register used for the drone (C1–C6).">Drone register</label>
            <select id="droneOctaveSelect"></select>
          </div>

          <div class="control">
            <label for="droneCustomHzInput">Drone root (Hz)</label>
            <input id="droneCustomHzInput" type="number" min="20" max="4000" step="0.01" value="440" />
            <input id="droneCustomHzSlider" type="range" min="20" max="4000" step="1" value="440" aria-label="Drone root Hz slider" />
          </div>

          <div class="control">
            <label for="droneVolume">Drone volume</label>
            <input id="droneVolume" type="range" min="0" max="100" value="50" />
          </div>

          <div class="control">
            <label for="liveCount">Scored bells</label>
            <select id="liveCount"></select>
          </div>

          <div class="control">
            <label>Pick scored bells</label>
            <div id="bellPicker" class="bell-picker" aria-label="Pick scored bells"></div>
          </div>

          <div class="control">
            <label>Keybindings</label>
            <div id="keybindPanel" class="keybind-panel" aria-label="Keybindings"></div>
            <div class="keybind-actions">
              <button id="keybindResetBtn" class="pill" type="button">Reset to defaults</button>
            </div>
            <div id="keybindNote" class="keybind-note"></div>
          </div>

          <div class="control">
            <label for="bpmInput">Tempo (BPM)</label>
            <input id="bpmInput" type="number" min="1" max="240" value="120" />
          </div>

          <div class="control mic-control">
            <label>Mic</label>
            <div class="path-row">
              <button id="micToggleBtn" class="pill" type="button" aria-pressed="false">Mic OFF</button>
              <button id="micCalibrateBtn" class="pill" type="button">Calibrate</button>
              <span id="micCalibrateStatus" class="mic-status"></span>
              <span id="micStatus" class="mic-status"></span>
            </div>
          </div>

          <div class="control">
            <label for="micCooldown">Mic cooldown (ms)</label>
            <input id="micCooldown" type="range" min="100" max="400" step="10" value="200" />
            <div id="micCooldownVal" class="mic-status"></div>
          </div>

          <div class="control view-control">
            <label>View</label>
            <div class="toggles" role="group" aria-label="View toggles">
              <label class="toggle"><input id="viewDisplay" type="checkbox" checked /> Display</label>
              <label class="toggle"><input id="viewSpotlight" type="checkbox" checked /> Spotlight</label>
              <label class="toggle"><input id="viewNotation" type="checkbox" checked /> Notation</label>
              <label class="toggle"><input id="viewStats" type="checkbox" checked /> Stats</label>
              <label class="toggle"><input id="viewMic" type="checkbox" /> Mic</label>
            </div>
          </div>

         
          <div class="control">
            <label>Display</label>
            <div class="toggles toggles--mini" role="group" aria-label="Display toggles">
              <label class="toggle"><input id="displayLiveOnly" type="checkbox" /> Display scored bell(s) only</label>
            </div>
          </div>

          <div class="control">
            <label>Spotlight swaps</label>
            <div class="toggles toggles--mini" role="group" aria-label="Spotlight swaps toggles">
              <label class="toggle"><input id="spotlightSwapsView" type="checkbox" /> Swaps view</label>
              <span id="spotlightSwapRows" class="toggles toggles--mini hidden" role="group" aria-label="Spotlight swap rows">
                <label class="toggle"><input id="spotlightShowN" type="checkbox" /> N</label>
                <label class="toggle"><input id="spotlightShowN1" type="checkbox" /> N+1</label>
                <label class="toggle"><input id="spotlightShowN2" type="checkbox" /> N+2</label>
              </span>
            </div>
          </div>

          <div class="control">
            <label>Notation swaps</label>
            <div class="toggles toggles--mini" role="group" aria-label="Notation swaps toggles">
              <label class="toggle"><input id="notationSwapsOverlay" type="checkbox" /> Notation swaps overlay</label>
            </div>
          </div>

          <div class="control path-control">
            <label>Line (blue line)</label>
            <div class="path-row">
              <button id="pathNoneBtn" class="pill active" type="button">None</button>
              <button id="pathAllBtn" class="pill" type="button">All</button>
              <div id="pathPicker" class="bell-picker bell-picker--small" aria-label="Line (blue line) bells"></div>
            </div>
          </div>

          <div class="control">
            <label for="fileInput">Custom file</label>
            <input id="fileInput" type="file" accept=".txt" />
          </div>

          <div class="control">
            <label for="xmlInput">CCCBR XML / ZIP</label>
            <input id="xmlInput" type="file" accept=".xml,.zip" multiple />
          </div>

          <div class="control control-buttons">
            <button id="startBtn">Start</button>
            <button id="pauseBtn" disabled>Pause</button>
            <button id="stopBtn" disabled>Stop</button>
            <button id="demoBtn">Demo</button>
            <button id="dronePauseBtn" class="hidden" disabled>Pause Drone</button>
          </div>
        </div>
      </header>


      <div id="rgMenuOverlay" class="hidden" aria-hidden="true">
        <div id="rgMenuPanel" class="pane" role="dialog" aria-modal="true" aria-label="Menu">
          <div class="rg-menu-head">
            <div class="pane-title"><span>Menu</span></div>
            <button id="rgMenuClose" type="button">Close</button>
          </div>
          <div class="rg-menu-buttons">
            <button id="rgMenuGoPlay" type="button">Setup</button>
            <button id="rgMenuGoView" type="button">View</button>
            <button id="rgMenuGoSound" type="button">Sound</button>
          </div>
        </div>
      </div>

      <main id="main" class="main">
        <div id="leftStack">
          <section id="displayPane" class="pane">
            <div class="pane-title"><span>Display</span></div>
            <canvas id="displayCanvas" aria-label="Display"></canvas>
          </section>

          <section id="spotlightPane" class="pane">
            <div class="pane-title"><span>Spotlight</span></div>
            <canvas id="spotlightCanvas" aria-label="Spotlight"></canvas>
          </section>

          <section id="micPane" class="pane hidden">
            <div class="pane-title"><span>Mic</span></div>
            <div class="mic-body">
              <div class="mic-meter" aria-label="Mic level meter"><div id="micMeterFill" class="mic-meter-fill"></div></div>
              <div class="mic-readouts">
                <div><span class="mic-label">Level</span><span id="micDbReadout">–∞ dB</span></div>
                <div id="micPaneStatus" class="mic-status"></div>
              </div>
            </div>
          </section>
        </div>

        <section id="notationPane" class="pane">
          <div class="pane-title"><span>Notation</span></div>
          <div class="notation-wrap">
            <canvas id="notationCanvas" aria-label="Notation"></canvas>
            <button id="notationPrevBtn" class="pill notation-page-nav hidden" type="button" aria-label="Previous notation pages">&lt;</button>
            <button id="notationNextBtn" class="pill notation-page-nav hidden" type="button" aria-label="Next notation pages">&gt;</button>
          </div>
        </section>

        <section id="statsPane" class="pane pane-span">
          <div class="pane-title">
            <span>Stats</span>
          </div>
          <div id="statsContent">
            <div id="stats"></div>
          </div>
        </section>

        <section id="methodLibrary" class="pane pane-span hidden">
          <div class="pane-title">
            <span>Method Library</span>
          </div>
          <div id="methodList"
               style="padding:12px;display:flex;flex-wrap:wrap;gap:8px;">
          </div>
        </section>
      </main>

      <footer class="footer">
        <p id="hint">Keys 1–9 (and 0/E/T for 10/11/12) ring bells by default. Use Keybindings to rebind scored bells (and Space/Enter when you have a single scored bell). Tap/click bells in the Display. Non-scored bells are rung by bots. Only your selected scored bells count toward your score.</p>
      </footer>
    
      </div>
</div>

    <script src="./app.js"></script>
  </body>
</html>
